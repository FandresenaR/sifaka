(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,27612,e=>{"use strict";let t=(0,e.i(75254).default)("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);e.s(["Trash2",()=>t],27612)},43531,e=>{"use strict";let t=(0,e.i(75254).default)("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);e.s(["Check",()=>t],43531)},56909,e=>{"use strict";let t=(0,e.i(75254).default)("Save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]);e.s(["Save",()=>t],56909)},5313,e=>{"use strict";var t=e.i(43476),a=e.i(71645),r=e.i(75254);let s=(0,r.default)("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]),l=(0,r.default)("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]),i=(0,r.default)("CloudDownload",[["path",{d:"M12 13v8l-4-4",key:"1f5nwf"}],["path",{d:"m12 21 4-4",key:"1lfcce"}],["path",{d:"M4.393 15.269A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.436 8.284",key:"ui1hmy"}]]);var d=e.i(57688),n=e.i(78583);let o=(0,r.default)("Film",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M7 3v18",key:"bbkbws"}],["path",{d:"M3 7.5h4",key:"zfgn84"}],["path",{d:"M3 12h18",key:"1i2n21"}],["path",{d:"M3 16.5h4",key:"1230mu"}],["path",{d:"M17 3v18",key:"in4fa5"}],["path",{d:"M17 7.5h4",key:"myr1c1"}],["path",{d:"M17 16.5h4",key:"go4c1d"}]]);var c=e.i(43531);function x({media:e,selected:a,onSelect:r,onClick:s}){let l="image"===e.type;return(0,t.jsxs)("div",{className:`group relative aspect-square bg-gray-100 dark:bg-gray-800 rounded-lg overflow-hidden border-2 transition-all cursor-pointer
        ${a?"border-blue-500 ring-2 ring-blue-500 ring-opacity-50":"border-transparent hover:border-gray-300 dark:hover:border-gray-600"}`,onClick:()=>s?.(e),children:[l?(0,t.jsx)(d.default,{src:e.url,alt:e.filename,fill:!0,className:"object-cover",sizes:"(max-width: 768px) 50vw, (max-width: 1200px) 33vw, 20vw"}):(0,t.jsx)("div",{className:"w-full h-full flex items-center justify-center text-gray-400",children:"video"===e.type?(0,t.jsx)(o,{size:48}):(0,t.jsx)(n.FileText,{size:48})}),(0,t.jsx)("div",{className:"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-30 transition-all flex flex-col justify-end p-2",children:(0,t.jsx)("p",{className:"text-white text-xs truncate opacity-0 group-hover:opacity-100 font-medium drop-shadow-md",children:e.filename})}),r&&(0,t.jsx)("div",{className:"absolute top-2 right-2 z-10",onClick:t=>{t.stopPropagation(),r(e)},children:(0,t.jsx)("div",{className:`w-6 h-6 rounded-full border-2 flex items-center justify-center transition-colors
            ${a?"bg-blue-500 border-blue-500 text-white":"bg-white/80 border-gray-300 text-transparent hover:border-blue-400"}`,children:(0,t.jsx)(c.Check,{size:14,strokeWidth:3})})})]})}let h=(0,r.default)("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);var u=e.i(37727);let p=(0,r.default)("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);function g({onUploadComplete:e}){let[r,s]=(0,a.useState)(!1),[l,i]=(0,a.useState)(!1),[d,n]=(0,a.useState)(null),o=(0,a.useRef)(null),c=async e=>{e.preventDefault(),s(!1),e.dataTransfer.files&&e.dataTransfer.files.length>0&&await g(Array.from(e.dataTransfer.files))},x=async e=>{e.target.files&&e.target.files.length>0&&await g(Array.from(e.target.files))},g=async t=>{i(!0),n(null);try{for(let a of t){let t=new FormData;t.append("file",a),t.append("folder","sifaka-media");let r=await fetch("/api/media",{method:"POST",body:t});if(!r.ok)throw Error(`Erreur lors de l'upload de ${a.name}`);let s=await r.json();e(s)}}catch(e){console.error(e),n(e.message||"Une erreur est survenue lors de l'upload")}finally{i(!1),o.current&&(o.current.value="")}};return(0,t.jsxs)("div",{className:"w-full",children:[(0,t.jsxs)("div",{className:`border-2 border-dashed rounded-lg p-8 text-center transition-colors cursor-pointer
          ${r?"border-blue-500 bg-blue-50 dark:bg-blue-900/20":"border-gray-300 dark:border-gray-700 hover:border-gray-400 dark:hover:border-gray-600"}
          ${l?"opacity-50 pointer-events-none":""}
        `,onDragOver:e=>{e.preventDefault(),s(!0)},onDragLeave:e=>{e.preventDefault(),s(!1)},onDrop:c,onClick:()=>o.current?.click(),children:[(0,t.jsx)("input",{type:"file",ref:o,className:"hidden",multiple:!0,accept:"image/*,video/*,application/pdf",onChange:x}),l?(0,t.jsxs)("div",{className:"flex flex-col items-center justify-center text-blue-600 dark:text-blue-400",children:[(0,t.jsx)(p,{className:"w-10 h-10 animate-spin mb-2"}),(0,t.jsx)("p",{className:"font-medium",children:"Upload en cours..."})]}):(0,t.jsxs)("div",{className:"flex flex-col items-center justify-center text-gray-500 dark:text-gray-400",children:[(0,t.jsx)(h,{className:"w-10 h-10 mb-2"}),(0,t.jsx)("p",{className:"font-medium text-gray-900 dark:text-gray-200",children:"Cliquez ou glissez des fichiers ici"}),(0,t.jsx)("p",{className:"text-sm mt-1",children:"Images, vidéos ou documents (max 5MB)"})]})]}),d&&(0,t.jsxs)("div",{className:"mt-2 p-3 bg-red-50 dark:bg-red-900/20 text-red-600 dark:text-red-400 rounded-md text-sm flex items-center justify-between",children:[(0,t.jsx)("span",{children:d}),(0,t.jsx)("button",{onClick:()=>n(null),className:"hover:text-red-800",children:(0,t.jsx)(u.X,{size:16})})]})]})}var m=e.i(56909),y=e.i(27612);let f=(0,r.default)("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]),b=(0,r.default)("ExternalLink",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]);function v({media:e,isOpen:r,onClose:s,onUpdate:l,onDelete:i}){let[c,x]=(0,a.useState)({title:e.title||"",alt:e.alt||"",description:e.description||"",tags:e.tags?.join(", ")||""}),[h,p]=(0,a.useState)(!1),[g,v]=(0,a.useState)(!1),[k,j]=(0,a.useState)(!1);if((0,a.useEffect)(()=>{x({title:e.title||"",alt:e.alt||"",description:e.description||"",tags:e.tags?.join(", ")||""})},[e]),!r)return null;let w=async()=>{p(!0);try{let t=c.tags.split(",").map(e=>e.trim()).filter(Boolean);await l(e.id,{...c,tags:t}),s()}catch(e){console.error("Error updating media:",e)}finally{p(!1)}},N=async()=>{if(confirm("Êtes-vous sûr de vouloir supprimer ce média ? Cette action est irréversible.")){v(!0);try{await i(e.id),s()}catch(e){console.error("Error deleting media:",e)}finally{v(!1)}}};return(0,t.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm p-4",children:(0,t.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl w-full max-w-4xl max-h-[90vh] overflow-hidden flex flex-col md:flex-row",children:[(0,t.jsx)("div",{className:"w-full md:w-1/2 bg-gray-100 dark:bg-gray-900 flex items-center justify-center p-4 relative min-h-[300px]",children:"image"===e.type?(0,t.jsx)("div",{className:"relative w-full h-full min-h-[300px]",children:(0,t.jsx)(d.default,{src:e.url,alt:e.alt||e.filename,fill:!0,className:"object-contain"})}):(0,t.jsxs)("div",{className:"text-gray-400 flex flex-col items-center",children:["video"===e.type?(0,t.jsx)(o,{size:64}):(0,t.jsx)(n.FileText,{size:64}),(0,t.jsx)("p",{className:"mt-4 text-sm font-medium",children:e.filename})]})}),(0,t.jsxs)("div",{className:"w-full md:w-1/2 flex flex-col h-full max-h-[90vh]",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between p-4 border-b dark:border-gray-700",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Détails du média"}),(0,t.jsx)("button",{onClick:s,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200",children:(0,t.jsx)(u.X,{size:20})})]}),(0,t.jsxs)("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4 text-sm text-gray-600 dark:text-gray-400 bg-gray-50 dark:bg-gray-900/50 p-3 rounded-lg",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"block text-xs uppercase text-gray-400",children:"Type"}),e.mimeType]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"block text-xs uppercase text-gray-400",children:"Taille"}),(e=>{if(0===e)return"0 B";let t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(2))+" "+["B","KB","MB","GB"][t]})(e.size)]}),e.width&&(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"block text-xs uppercase text-gray-400",children:"Dimensions"}),e.width," x ",e.height]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"block text-xs uppercase text-gray-400",children:"Date"}),new Date(e.createdAt).toLocaleDateString()]})]}),(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Titre"}),(0,t.jsx)("input",{type:"text",value:c.title,onChange:e=>x({...c,title:e.target.value}),className:"w-full px-3 py-2 border rounded-md dark:bg-gray-700 dark:border-gray-600 dark:text-white focus:ring-2 focus:ring-blue-500"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Texte alternatif (Alt)"}),(0,t.jsx)("input",{type:"text",value:c.alt,onChange:e=>x({...c,alt:e.target.value}),className:"w-full px-3 py-2 border rounded-md dark:bg-gray-700 dark:border-gray-600 dark:text-white focus:ring-2 focus:ring-blue-500",placeholder:"Description pour l'accessibilité et le SEO"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Tags (séparés par des virgules)"}),(0,t.jsx)("input",{type:"text",value:c.tags,onChange:e=>x({...c,tags:e.target.value}),className:"w-full px-3 py-2 border rounded-md dark:bg-gray-700 dark:border-gray-600 dark:text-white focus:ring-2 focus:ring-blue-500",placeholder:"nature, baobab, madagascar"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Description"}),(0,t.jsx)("textarea",{value:c.description,onChange:e=>x({...c,description:e.target.value}),rows:3,className:"w-full px-3 py-2 border rounded-md dark:bg-gray-700 dark:border-gray-600 dark:text-white focus:ring-2 focus:ring-blue-500"})]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2 p-3 bg-gray-50 dark:bg-gray-900/50 rounded-lg border dark:border-gray-700",children:[(0,t.jsx)("input",{type:"text",readOnly:!0,value:e.url,className:"flex-1 bg-transparent text-sm text-gray-600 dark:text-gray-300 outline-none"}),(0,t.jsx)("button",{onClick:()=>{navigator.clipboard.writeText(e.url),j(!0),setTimeout(()=>j(!1),2e3)},className:"text-gray-500 hover:text-blue-600 dark:text-gray-400 dark:hover:text-blue-400",title:"Copier l'URL",children:k?(0,t.jsx)("span",{className:"text-green-500 text-xs font-bold",children:"Copié!"}):(0,t.jsx)(f,{size:16})}),(0,t.jsx)("a",{href:e.url,target:"_blank",rel:"noopener noreferrer",className:"text-gray-500 hover:text-blue-600 dark:text-gray-400 dark:hover:text-blue-400",title:"Ouvrir dans un nouvel onglet",children:(0,t.jsx)(b,{size:16})})]})]}),(0,t.jsxs)("div",{className:"p-4 border-t dark:border-gray-700 flex justify-between items-center bg-gray-50 dark:bg-gray-800",children:[(0,t.jsxs)("button",{onClick:N,disabled:g,className:"flex items-center gap-2 px-4 py-2 text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-md transition-colors disabled:opacity-50",children:[(0,t.jsx)(y.Trash2,{size:18}),(0,t.jsx)("span",{className:"hidden sm:inline",children:"Supprimer"})]}),(0,t.jsxs)("div",{className:"flex gap-3",children:[(0,t.jsx)("button",{onClick:s,className:"px-4 py-2 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md transition-colors",children:"Annuler"}),(0,t.jsxs)("button",{onClick:w,disabled:h,className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white hover:bg-blue-700 rounded-md transition-colors disabled:opacity-50",children:[(0,t.jsx)(m.Save,{size:18}),(0,t.jsx)("span",{children:h?"Enregistrement...":"Enregistrer"})]})]})]})]})]})})}function k({onSelect:e,selectionMode:r=!1}){let[d,n]=(0,a.useState)([]),[o,c]=(0,a.useState)(!0),[h,u]=(0,a.useState)({type:"",search:"",tag:""}),[p,m]=(0,a.useState)({total:0,limit:20,offset:0,hasMore:!1}),[y,f]=(0,a.useState)(null),[b,k]=(0,a.useState)(!1),[j,w]=(0,a.useState)(!1),N=(0,a.useCallback)(async(e=!1,t)=>{c(!0);try{let a=new URLSearchParams;h.type&&a.append("type",h.type),h.search&&a.append("search",h.search),h.tag&&a.append("tag",h.tag);let r=t??(e?0:p.offset);a.append("limit",p.limit.toString()),a.append("offset",r.toString());let s=await fetch(`/api/media?${a.toString()}`),l=await s.json();e?n(l.media):n(e=>[...e,...l.media]),m(l.pagination)}catch(e){console.error("Error fetching media:",e)}finally{c(!1)}},[h,p.limit,p.offset]);(0,a.useEffect)(()=>{N(!0)},[N]);let C=async(e,t)=>{let a=await fetch(`/api/media/${e}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(a.ok){let t=await a.json();n(a=>a.map(a=>a.id===e?t:a))}},M=async e=>{(await fetch(`/api/media/${e}`,{method:"DELETE"})).ok&&(n(t=>t.filter(t=>t.id!==e)),k(!1))},S=async()=>{w(!0);try{let e=await fetch("/api/media/sync",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({})}),t=await e.json();e.ok?(alert(`Synchronisation termin\xe9e : ${t.added} ajout\xe9s, ${t.skipped} ignor\xe9s.`),N(!0)):alert("Erreur lors de la synchronisation")}catch(e){console.error("Error syncing:",e),alert("Erreur lors de la synchronisation")}finally{w(!1)}};return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"flex flex-col md:flex-row gap-4 justify-between items-start md:items-center bg-white dark:bg-gray-800 p-4 rounded-lg shadow-sm",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 w-full md:w-auto",children:[(0,t.jsxs)("div",{className:"relative flex-1 md:w-64",children:[(0,t.jsx)(s,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400",size:18}),(0,t.jsx)("input",{type:"text",placeholder:"Rechercher...",value:h.search,onChange:e=>u({...h,search:e.target.value}),className:"w-full pl-10 pr-4 py-2 border rounded-md dark:bg-gray-700 dark:border-gray-600 dark:text-white focus:ring-2 focus:ring-blue-500"})]}),(0,t.jsxs)("select",{value:h.type,onChange:e=>u({...h,type:e.target.value}),className:"px-3 py-2 border rounded-md dark:bg-gray-700 dark:border-gray-600 dark:text-white focus:ring-2 focus:ring-blue-500",children:[(0,t.jsx)("option",{value:"",children:"Tous les types"}),(0,t.jsx)("option",{value:"image",children:"Images"}),(0,t.jsx)("option",{value:"video",children:"Vidéos"}),(0,t.jsx)("option",{value:"document",children:"Documents"})]})]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsxs)("button",{onClick:S,disabled:j,className:"flex items-center gap-2 px-3 py-2 bg-blue-50 text-blue-600 rounded-md hover:bg-blue-100 transition-colors disabled:opacity-50",title:"Synchroniser avec le storage",children:[(0,t.jsx)(i,{size:20,className:j?"animate-bounce":""}),(0,t.jsx)("span",{className:"hidden sm:inline",children:"Sync"})]}),(0,t.jsx)("button",{onClick:()=>N(!0),className:"p-2 text-gray-500 hover:text-blue-600 transition-colors",title:"Rafraîchir",children:(0,t.jsx)(l,{size:20})})]})]}),!r&&(0,t.jsx)(g,{onUploadComplete:e=>{n(t=>[e,...t])}}),o&&0===d.length?(0,t.jsx)("div",{className:"flex justify-center py-12",children:(0,t.jsx)(l,{className:"animate-spin text-blue-500",size:32})}):d.length>0?(0,t.jsx)("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4",children:d.map(a=>(0,t.jsx)(x,{media:a,onClick:t=>{r&&e?e(t):(f(t),k(!0))}},a.id))}):(0,t.jsx)("div",{className:"text-center py-12 text-gray-500 dark:text-gray-400",children:"Aucun média trouvé"}),p.hasMore&&(0,t.jsx)("div",{className:"flex justify-center pt-4",children:(0,t.jsx)("button",{onClick:()=>{p.hasMore&&N(!1,p.offset+p.limit)},disabled:o,className:"px-6 py-2 bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-200 rounded-md hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors disabled:opacity-50",children:o?"Chargement...":"Charger plus"})}),y&&(0,t.jsx)(v,{media:y,isOpen:b,onClose:()=>k(!1),onUpdate:C,onDelete:M})]})}e.s(["default",()=>k],5313)}]);